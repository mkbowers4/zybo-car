library IEEE;
use IEEE.STD_LOGIC_1164.ALL;
use ieee.numeric_std.all;
use ieee.std_logic_unsigned.all;
use std.env.finish;
use std.textio.all;
use ieee.std_logic_textio.all;

-- Uncomment the following library declaration if using
-- arithmetic functions with Signed or Unsigned values
--use IEEE.NUMERIC_STD.ALL;

-- Uncomment the following library declaration if instantiating
-- any Xilinx leaf cells in this code.
--library UNISIM;
--use UNISIM.VComponents.all;

entity color_tb is
end color_tb;

architecture Behavioral of color_tb is

component color is
    Port (
        PixelClk: in std_logic;
        sel: in std_logic_vector(3 downto 0); 
        vid_data_in: in std_logic_vector(23 downto 0); -- R is 23:16, B is 15:8, G is 7:0 
        vid_active_video_in : in std_logic;
        vid_field_id_in: in std_logic;
        vid_hblank_in: in std_logic;
        vid_hsync_in: in std_logic;
        vid_vblank_in: in std_logic;
        vid_vsync_in: in std_logic;
        vid_data_out: out std_logic_vector(23 downto 0);
        vid_active_video_out: out std_logic;
        vid_field_id_out: out std_logic;
        vid_hblank_out: out std_logic;
        vid_hsync_out: out std_logic;
        vid_vblank_out: out std_logic;
        vid_vsync_out: out std_logic   );
        
end component;
   type header_type  is array (0 to 53) of character;
 
   type pixel_type is record
      red : std_logic_vector(7 downto 0);
      green : std_logic_vector(7 downto 0);
      blue : std_logic_vector(7 downto 0);
   end record;
     
   type row_type is array (integer range <>) of pixel_type;
   type row_pointer is access row_type;
   type image_type is array (integer range <>) of row_pointer;
   type image_pointer is access image_type;  

  signal  PixelClk_tb: std_logic;                                                                                    
  signal  sel_tb:  std_logic_vector(3 downto 0);                                                                                             
  signal  vid_data_in_tb, vid_data_inin_tb:  std_logic_vector(23 downto 0) := x"000000"; -- R is 23:16, B is 15:8, G is 7:0    
  signal  vid_active_video_in_tb :  std_logic := '0';                                                  
  signal  vid_field_id_in_tb:  std_logic;                                                       
  signal  vid_hblank_in_tb:  std_logic := '1';                                                         
  signal  vid_hsync_in_tb:  std_logic := '0';                                                      
  signal  vid_vblank_in_tb:  std_logic;                                                         
  signal  vid_vsync_in_tb:  std_logic;                                                          
                                                                                         
  signal  vid_data_out_tb:  std_logic_vector(23 downto 0);                                     
  signal  vid_active_video_out_tb:  std_logic;                                                 
  signal  vid_field_id_out_tb:  std_logic;                                                     
  signal  vid_hblank_out_tb:  std_logic;                                                       
  signal  vid_hsync_out_tb:  std_logic;                                                        
  signal  vid_vblank_out_tb:  std_logic;                                                       
  signal  vid_vsync_out_tb:  std_logic;   
    
  constant T : time := 10 ns;
  
  constant vblanksize : integer := 49500;
  constant hblanksize: integer := 380;
  constant vidonsize: integer := 1280;
  
  constant nlines: integer := 720;
  
  
  constant totalcountinline: integer := 1650;
  signal countinline, countvertical: integer :=0;
 -- signal vidon: std_logic := '0';
    signal testlane1, testlane2: std_logic := '0';
  
  signal vpcount: integer := 0;
  signal hpcount: integer := 0;
  type STATE is (vblank, activevideo, hblank);
  signal wavestatetb : STATE :=hblank;
  
  --constant textfile: STRING := "outimg"&integer'image(to_integer(unsigned(sel)))&".txt";
  --signal done: std_logic := '0';
  
  signal flip: std_logic := '1';
  
  type slice is array (0 to 1279) of std_logic_vector(23 downto 0);
  constant IMGSLICE: slice :=(
                        x"7E8787",
                        x"8A9393",
                        x"7E7C5F",
                        x"6F6D50",
                        x"685F3F",
                        x"685F3F",
                        x"655F3C",
                        x"655F3C",
                        x"6F664D",
                        x"726950",
                        x"7C7359",
                        x"80775E",
                        x"776E55",
                        x"71684F",
                        x"6F664D",
                        x"726950",
                        x"776651",
                        x"7A6A55",
                        x"7B6D57",
                        x"7B6D57",
                        x"7B7059",
                        x"7C715A",
                        x"807760",
                        x"857C65",
                        x"877F6D",
                        x"837C69",
                        x"7F7764",
                        x"7C7562",
                        x"726A58",
                        x"6E6754",
                        x"665F4C",
                        x"645C4A",
                        x"595034",
                        x"564E32",
                        x"52472E",
                        x"51462D",
                        x"574837",
                        x"5F503F",
                        x"705F50",
                        x"786759",
                        x"796F66",
                        x"7F756C",
                        x"7E7464",
                        x"766C5C",
                        x"6F6A50",
                        x"716D52",
                        x"6E6A49",
                        x"696544",
                        x"666449",
                        x"646247",
                        x"686349",
                        x"6C684E",
                        x"665C43",
                        x"60573D",
                        x"5D543B",
                        x"5F553C",
                        x"675C45",
                        x"6F644E",
                        x"736751",
                        x"756A53",
                        x"6F644E",
                        x"6E634C",
                        x"645842",
                        x"594E37",
                        x"4F482A",
                        x"4A4425",
                        x"50422C",
                        x"53452F",
                        x"5D5346",
                        x"6B6154",
                        x"726E64",
                        x"807C72",
                        x"818272",
                        x"838474",
                        x"878568",
                        x"828063",
                        x"878062",
                        x"827C5D",
                        x"7C7260",
                        x"766C5A",
                        x"73684F",
                        x"73684F",
                        x"776D5B",
                        x"776D5B",
                        x"766F5E",
                        x"797161",
                        x"767460",
                        x"767460",
                        x"787157",
                        x"756E55",
                        x"716A4E",
                        x"6B6448",
                        x"5B5032",
                        x"514629",
                        x"4D4126",
                        x"4F4429",
                        x"534937",
                        x"5C5340",
                        x"6F6551",
                        x"786F5A",
                        x"7F715E",
                        x"7C6E5A",
                        x"796855",
                        x"756552",
                        x"6B6651",
                        x"6C6852",
                        x"6E6953",
                        x"6C6852",
                        x"757058",
                        x"7F7A63",
                        x"868169",
                        x"807C64",
                        x"7C755E",
                        x"756E57",
                        x"6B644C",
                        x"68614A",
                        x"726B53",
                        x"756E57",
                        x"787159",
                        x"766F58",
                        x"6D6245",
                        x"6A5F41",
                        x"64593C",
                        x"5F5437",
                        x"564B2E",
                        x"4B4023",
                        x"483D20",
                        x"463B1D",
                        x"6A6055",
                        x"6E6358",
                        x"756B5D",
                        x"786E60",
                        x"726956",
                        x"726956",
                        x"6B624B",
                        x"645B44",
                        x"665F48",
                        x"68614A",
                        x"7A715A",
                        x"8D846D",
                        x"988873",
                        x"92826D",
                        x"8D7B66",
                        x"8C7A65",
                        x"837965",
                        x"7E7460",
                        x"7C725E",
                        x"7D735F",
                        x"867D68",
                        x"8B816D",
                        x"8E8570",
                        x"8C826E",
                        x"837A5C",
                        x"797153",
                        x"716648",
                        x"695E40",
                        x"5A4C32",
                        x"4E4126",
                        x"483820",
                        x"493922",
                        x"554D3F",
                        x"5F5749",
                        x"7D7363",
                        x"938979",
                        x"9F957E",
                        x"A79D87",
                        x"A39C84",
                        x"968F77",
                        x"8D8666",
                        x"8B8565",
                        x"888163",
                        x"878062",
                        x"948F77",
                        x"959179",
                        x"99947E",
                        x"9A957F",
                        x"908568",
                        x"8A7F62",
                        x"827B5F",
                        x"80795D",
                        x"87846C",
                        x"8C8A72",
                        x"8E8E77",
                        x"90907A",
                        x"8F9072",
                        x"868669",
                        x"7D765F",
                        x"746D56",
                        x"70624A",
                        x"6B5E46",
                        x"69573C",
                        x"655337",
                        x"5B4836",
                        x"53402E",
                        x"544635",
                        x"594A39",
                        x"686150",
                        x"6D6555",
                        x"737060",
                        x"777465",
                        x"7A735E",
                        x"7C7560",
                        x"817863",
                        x"837965",
                        x"867865",
                        x"8E806D",
                        x"958774",
                        x"9F917D",
                        x"A3977F",
                        x"A2967D",
                        x"948870",
                        x"867A62",
                        x"7F735B",
                        x"7B7057",
                        x"7C7158",
                        x"7F735B",
                        x"85775F",
                        x"85775F",
                        x"86795E",
                        x"877A5F",
                        x"796C4F",
                        x"74664A",
                        x"746747",
                        x"726546",
                        x"716445",
                        x"706344",
                        x"675839",
                        x"5E4F30",
                        x"574527",
                        x"584628",
                        x"5B4729",
                        x"5C482A",
                        x"60553E",
                        x"635741",
                        x"736A53",
                        x"857C65",
                        x"8B846D",
                        x"928B74",
                        x"8D8870",
                        x"948F77",
                        x"8D8570",
                        x"88816C",
                        x"8A836E",
                        x"8F8873",
                        x"948C77",
                        x"948C77",
                        x"958D78",
                        x"928B76",
                        x"A8ADA5",
                        x"BDC2BA",
                        x"D6DAD7",
                        x"EEF3F0",
                        x"EFF8FB",
                        x"F6FFFF",
                        x"F3FBFF",
                        x"FAFFFF",
                        x"FFFFFF",
                        x"FFFFFF",
                        x"FBFFFE",
                        x"FBFFFE",
                        x"FBFFFF",
                        x"FBFFFF",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFF",
                        x"FEFEFF",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FFFFFF",
                        x"FCFCFC",
                        x"E1E1E1",
                        x"CECDCE",
                        x"AEB288",
                        x"83875D",
                        x"9A8157",
                        x"876D43",
                        x"827660",
                        x"887C66",
                        x"837D5E",
                        x"837D5E",
                        x"7F7752",
                        x"756D48",
                        x"6C6237",
                        x"62582D",
                        x"4E421E",
                        x"4A3D19",
                        x"42321D",
                        x"3D2D18",
                        x"4B341E",
                        x"4C351F",
                        x"54422D",
                        x"5F4C37",
                        x"645D48",
                        x"6A624D",
                        x"72725D",
                        x"787863",
                        x"706D47",
                        x"716E48",
                        x"746E49",
                        x"756F4A",
                        x"817A5E",
                        x"837D61",
                        x"888163",
                        x"8A8465",
                        x"898364",
                        x"8B8567",
                        x"908A6B",
                        x"958E70",
                        x"989475",
                        x"949071",
                        x"908970",
                        x"8E876D",
                        x"847E64",
                        x"817A60",
                        x"767050",
                        x"736D4C",
                        x"746E4D",
                        x"767050",
                        x"847E64",
                        x"908970",
                        x"908A69",
                        x"8F8968",
                        x"8F8861",
                        x"847C55",
                        x"7C724C",
                        x"726841",
                        x"6B5E3F",
                        x"5F5232",
                        x"56462C",
                        x"514128",
                        x"504026",
                        x"54442A",
                        x"4F4429",
                        x"564B30",
                        x"63573C",
                        x"6D6247",
                        x"857C61",
                        x"8D8469",
                        x"948D71",
                        x"958E72",
                        x"959174",
                        x"959174",
                        x"8E8C6F",
                        x"878568",
                        x"8A7F64",
                        x"887D62",
                        x"837D61",
                        x"888165",
                        x"929274",
                        x"969779",
                        x"97997B",
                        x"929577",
                        x"9B9872",
                        x"96936D",
                        x"96936D",
                        x"9B9872",
                        x"9B9872",
                        x"99956F",
                        x"928E68",
                        x"918D67",
                        x"928D73",
                        x"938E74",
                        x"969276",
                        x"999478",
                        x"9F9B7C",
                        x"989475",
                        x"8C8867",
                        x"7F7B5A",
                        x"6F623C",
                        x"61542E",
                        x"4C3F1E",
                        x"453817",
                        x"43351D",
                        x"4A3C24",
                        x"544834",
                        x"594D3A",
                        x"6C6550",
                        x"89826D",
                        x"9A947A",
                        x"9F987F",
                        x"9F9978",
                        x"9F9978",
                        x"A09B75",
                        x"A09B75",
                        x"ACA685",
                        x"A49E7D",
                        x"A09A7A",
                        x"9A9474",
                        x"8F8968",
                        x"898362",
                        x"7D7757",
                        x"787151",
                        x"7C7359",
                        x"7C7359",
                        x"7C7260",
                        x"7C7260",
                        x"776D59",
                        x"756B57",
                        x"716949",
                        x"706847",
                        x"6D6742",
                        x"716B46",
                        x"7C7653",
                        x"847E5B",
                        x"848363",
                        x"989677",
                        x"9C9A7A",
                        x"9F9D7E",
                        x"A09A77",
                        x"A39D7A",
                        x"A19471",
                        x"988B67",
                        x"867554",
                        x"71603F",
                        x"645030",
                        x"4F3B1B",
                        x"49311E",
                        x"503825",
                        x"594B37",
                        x"665744",
                        x"777664",
                        x"90907E",
                        x"8F9886",
                        x"949C8A",
                        x"9D9B77",
                        x"9C9A76",
                        x"96936D",
                        x"918D67",
                        x"857953",
                        x"7D704A",
                        x"776840",
                        x"786941",
                        x"7D7458",
                        x"837A5E",
                        x"7D7759",
                        x"756F50",
                        x"797755",
                        x"838260",
                        x"83825E",
                        x"807E5A",
                        x"88875E",
                        x"8E8D64",
                        x"8F8E65",
                        x"89885F",
                        x"828158",
                        x"807F56",
                        x"83825A",
                        x"88875E",
                        x"98906B",
                        x"A09873",
                        x"9B936E",
                        x"918964",
                        x"897C58",
                        x"847753",
                        x"7C6F4B",
                        x"726642",
                        x"645A33",
                        x"584E27",
                        x"553D19",
                        x"4A320F",
                        x"492C0F",
                        x"442609",
                        x"3F260C",
                        x"42290F",
                        x"503B27",
                        x"56412D",
                        x"624D36",
                        x"68533C",
                        x"6A5F41",
                        x"695E40",
                        x"6A5A3E",
                        x"706044",
                        x"706042",
                        x"736445",
                        x"786B4C",
                        x"7D7051",
                        x"7C7655",
                        x"807A59",
                        x"8B8766",
                        x"959170",
                        x"9F9B75",
                        x"A3A07A",
                        x"9F9A72",
                        x"958F67",
                        x"8D865C",
                        x"867F55",
                        x"7A7045",
                        x"746A3F",
                        x"6C6945",
                        x"716E4A",
                        x"85815E",
                        x"938F6C",
                        x"94906D",
                        x"95926E",
                        x"928E6B",
                        x"8C8865",
                        x"8A805E",
                        x"887D5B",
                        x"867B59",
                        x"837957",
                        x"7F7452",
                        x"7C7250",
                        x"6E6442",
                        x"645937",
                        x"574326",
                        x"4C371A",
                        x"49351A",
                        x"4F3B20",
                        x"57422E",
                        x"624D39",
                        x"65503E",
                        x"66513F",
                        x"6C684C",
                        x"7C775B",
                        x"858162",
                        x"878364",
                        x"8F8C66",
                        x"928E68",
                        x"95926A",
                        x"96936B",
                        x"8E946A",
                        x"8E946A",
                        x"8D9369",
                        x"8E946A",
                        x"85865D",
                        x"84855C",
                        x"81835A",
                        x"81835A",
                        x"807E5A",
                        x"7E7D59",
                        x"7E7B55",
                        x"7D7953",
                        x"767147",
                        x"767147",
                        x"7D7648",
                        x"7E7749",
                        x"7A754B",
                        x"7B764C",
                        x"827D53",
                        x"878157",
                        x"87845A",
                        x"8B885D",
                        x"8D8A60",
                        x"8B885D",
                        x"918D65",
                        x"8F8C64",
                        x"8E8B63",
                        x"8D8A62",
                        x"918E61",
                        x"949164",
                        x"8D8A5D",
                        x"848154",
                        x"6D6040",
                        x"544728",
                        x"3D2E12",
                        x"322206",
                        x"3A230A",
                        x"3C250D",
                        x"442814",
                        x"462B16",
                        x"4B3C22",
                        x"57472D",
                        x"5C583B",
                        x"736F53",
                        x"7B7958",
                        x"888665",
                        x"958D68",
                        x"9C946F",
                        x"A3A17D",
                        x"9E9D79",
                        x"9D9A74",
                        x"9D9A74",
                        x"96906B",
                        x"96906B",
                        x"938B66",
                        x"88805C",
                        x"90865F",
                        x"8E845D",
                        x"928862",
                        x"988E67",
                        x"968F67",
                        x"928A63",
                        x"8E865F",
                        x"88815A",
                        x"7D704A",
                        x"776B45",
                        x"746741",
                        x"756842",
                        x"6E6A44",
                        x"7C7852",
                        x"878561",
                        x"908F6B",
                        x"A0A17C",
                        x"A8A984",
                        x"A8A481",
                        x"96936F",
                        x"8B7C5B",
                        x"796A49",
                        x"6F5B3B",
                        x"645030",
                        x"54472A",
                        x"504225",
                        x"554028",
                        x"5A452C",
                        x"665842",
                        x"776953",
                        x"81816A",
                        x"90907A",
                        x"8C9064",
                        x"93976B",
                        x"909360",
                        x"8E905E",
                        x"918C5E",
                        x"959061",
                        x"8D865C",
                        x"837B52",
                        x"7E7651",
                        x"7F7752",
                        x"817955",
                        x"837B56",
                        x"8F8767",
                        x"918868",
                        x"938A6A",
                        x"948C6C",
                        x"908B61",
                        x"8F8A60",
                        x"8D875D",
                        x"8B865C",
                        x"9A956B",
                        x"9C966C",
                        x"9F9A70",
                        x"A09B71",
                        x"928F64",
                        x"8D8A60",
                        x"8F8A60",
                        x"928D63",
                        x"A09B71",
                        x"A6A177",
                        x"AEA67D",
                        x"ADA57B",
                        x"A7A37B",
                        x"9A976E",
                        x"99916C",
                        x"958D68",
                        x"938261",
                        x"867554",
                        x"755E42",
                        x"5F482B",
                        x"50391C",
                        x"50391C",
                        x"554A2A",
                        x"6B6040",
                        x"706C4F",
                        x"7F7B5E",
                        x"8D866A",
                        x"928C70",
                        x"96956E",
                        x"96956E",
                        x"98946E",
                        x"98946E",
                        x"938F6A",
                        x"8B8761",
                        x"8B8562",
                        x"918B68",
                        x"948A61",
                        x"9E946B",
                        x"A69C73",
                        x"ACA279",
                        x"ADA37A",
                        x"A99F76",
                        x"A2986F",
                        x"988E65",
                        x"95815F",
                        x"897653",
                        x"7E694E",
                        x"79654A",
                        x"75664C",
                        x"77674D",
                        x"776A4B",
                        x"7E7152",
                        x"87815E",
                        x"8F8966",
                        x"96906D",
                        x"97916E",
                        x"918C64",
                        x"918C64",
                        x"918C64",
                        x"928D65",
                        x"998C68",
                        x"9C906C",
                        x"9E9066",
                        x"8E7F55",
                        x"7E6942",
                        x"604A24",
                        x"61482B",
                        x"5F472A",
                        x"675C41",
                        x"74694E",
                        x"817659",
                        x"978C6F",
                        x"978C6D",
                        x"928868",
                        x"918765",
                        x"948967",
                        x"938B66",
                        x"918964",
                        x"8C845F",
                        x"867E59",
                        x"8B8262",
                        x"988F6F",
                        x"A49C7C",
                        x"A39B7B",
                        x"A29A77",
                        x"9C9472",
                        x"958D68",
                        x"938B66",
                        x"989069",
                        x"9A926B",
                        x"918962",
                        x"847C55",
                        x"827C57",
                        x"807A55",
                        x"8A855D",
                        x"97916A",
                        x"A09B71",
                        x"9F9A70",
                        x"A19A6E",
                        x"A39C70",
                        x"AA9B73",
                        x"A99A72",
                        x"A69973",
                        x"A69973",
                        x"9C916D",
                        x"968C67",
                        x"8E8363",
                        x"7A6F50",
                        x"766446",
                        x"635234",
                        x"5B442C",
                        x"503921",
                        x"504026",
                        x"55452B",
                        x"5B573A",
                        x"726E51",
                        x"7E7E61",
                        x"7E7E61",
                        x"817F62",
                        x"838164",
                        x"948B70",
                        x"968E72",
                        x"958C71",
                        x"91886C",
                        x"8A8465",
                        x"878062",
                        x"847E5E",
                        x"888261",
                        x"867F5F",
                        x"888261",
                        x"8F8966",
                        x"908A67",
                        x"A19B7D",
                        x"AFA98B",
                        x"B8B28D",
                        x"B9B38E",
                        x"B5B086",
                        x"ADA87E",
                        x"A8A175",
                        x"A8A175",
                        x"A7A37B",
                        x"A3A078",
                        x"A19D7E",
                        x"9D997A",
                        x"95946B",
                        x"93936A",
                        x"969779",
                        x"9E9F81",
                        x"AFB183",
                        x"B2B486",
                        x"B8B589",
                        x"B3B184",
                        x"B1A77C",
                        x"AAA075",
                        x"9B8C62",
                        x"887A50",
                        x"846854",
                        x"745843",
                        x"65503A",
                        x"614C35",
                        x"60553C",
                        x"746950",
                        x"7B745B",
                        x"847E64",
                        x"8B7E5A",
                        x"8D815D",
                        x"918460",
                        x"928561",
                        x"998C68",
                        x"988B67",
                        x"938663",
                        x"8C7F5C",
                        x"8A7D5B",
                        x"877B59",
                        x"817654",
                        x"7D7351",
                        x"847E5B",
                        x"9C9673",
                        x"AAA783",
                        x"B8B591",
                        x"C0B896",
                        x"C0B896",
                        x"BDB592",
                        x"B4AB89",
                        x"AAA280",
                        x"9F9674",
                        x"8A815F",
                        x"7F7754",
                        x"887D5E",
                        x"8D8262",
                        x"978C6D",
                        x"9F9475",
                        x"A09676",
                        x"9F9475",
                        x"978C6D",
                        x"928868",
                        x"8D8260",
                        x"8D8260",
                        x"8F805F",
                        x"8E7F5E",
                        x"837050",
                        x"746041",
                        x"6C5536",
                        x"614B2C",
                        x"5B4430",
                        x"563E2B",
                        x"4E3D21",
                        x"534125",
                        x"5F5533",
                        x"675D3B",
                        x"726B4D",
                        x"80795B",
                        x"898A6A",
                        x"8F9070",
                        x"969777",
                        x"999979",
                        x"959676",
                        x"8E8F6F",
                        x"888465",
                        x"807C5D",
                        x"877D56",
                        x"8B815B",
                        x"8E845D",
                        x"8F855E",
                        x"8E8664",
                        x"8D8562",
                        x"8D8562",
                        x"8C8461",
                        x"8D815D",
                        x"8A7D59",
                        x"8B7E5A",
                        x"90835F",
                        x"857855",
                        x"857855",
                        x"837652",
                        x"837652",
                        x"908664",
                        x"918765",
                        x"918765",
                        x"918765",
                        x"877F5D",
                        x"8A815F",
                        x"86805D",
                        x"827C59",
                        x"7B7458",
                        x"797256",
                        x"786F54",
                        x"6F664A",
                        x"6D5D43",
                        x"6B5B41",
                        x"69573E",
                        x"67553B",
                        x"696045",
                        x"736B4F",
                        x"81795D",
                        x"8F876B",
                        x"9B9277",
                        x"9D9579",
                        x"9C9378",
                        x"948B70",
                        x"928C70",
                        x"948D71",
                        x"999072",
                        x"9A9173",
                        x"A09670",
                        x"9C926B",
                        x"958B62",
                        x"8D835A",
                        x"857859",
                        x"857859",
                        x"8A7F62",
                        x"918669",
                        x"948B70",
                        x"968E72",
                        x"918A71",
                        x"8D866C",
                        x"92876A",
                        x"908568",
                        x"84795C",
                        x"7B7053",
                        x"726A4C",
                        x"7F7759",
                        x"888062",
                        x"8D8467",
                        x"8F8767",
                        x"8B8262",
                        x"86795A",
                        x"837657",
                        x"7C6D4E",
                        x"776749",
                        x"695739",
                        x"5F4D2F",
                        x"5D4627",
                        x"644D2E",
                        x"6D594E",
                        x"836F64",
                        x"887C64",
                        x"968A72",
                        x"958E72",
                        x"8D866A",
                        x"897C5A",
                        x"827553",
                        x"796E4E",
                        x"786D4D",
                        x"7C7657",
                        x"817B5C",
                        x"888468",
                        x"8E8A6D",
                        x"9A907E",
                        x"9F9583",
                        x"9A917A",
                        x"8F866F",
                        x"99916E",
                        x"ADA482",
                        x"B0A881",
                        x"AFA780",
                        x"B6B28D",
                        x"B9B690",
                        x"AFAB86",
                        x"9D9A74",
                        x"9B9872",
                        x"A09C76",
                        x"AAA781",
                        x"B3B08A",
                        x"B5B490",
                        x"A7A682",
                        x"94906D",
                        x"807D59",
                        x"8D8764",
                        x"A09A77",
                        x"99916E",
                        x"847C59",
                        x"877A5F",
                        x"8B7D63",
                        x"92846A",
                        x"918369",
                        x"94876C",
                        x"8C7F64",
                        x"796C51",
                        x"706348",
                        x"726340",
                        x"81724F",
                        x"908361",
                        x"928564",
                        x"948C6C",
                        x"9A9171",
                        x"A49D7F",
                        x"AEA88A",
                        x"BAAA8E",
                        x"C2B396",
                        x"C0B396",
                        x"B7AA8D",
                        x"B1A987",
                        x"B1A987",
                        x"B2AC89",
                        x"B2AC89",
                        x"B8AC94",
                        x"B7AB92",
                        x"ACA188",
                        x"A49880",
                        x"968B6E",
                        x"94896B",
                        x"988D70",
                        x"9F9477",
                        x"9D997D",
                        x"A29E81",
                        x"A9A083",
                        x"A79E80",
                        x"A08E70",
                        x"948365",
                        x"937D5E",
                        x"917B5B",
                        x"958774",
                        x"9A8C78",
                        x"998A70",
                        x"8D7D63",
                        x"786754",
                        x"63523F",
                        x"655138",
                        x"6D5940",
                        x"6B5E43",
                        x"7E7156",
                        x"8A7B6A",
                        x"928472",
                        x"9C9173",
                        x"9F9477",
                        x"A1987F",
                        x"A29980",
                        x"A09A7E",
                        x"9E977B",
                        x"918B6F",
                        x"867F63",
                        x"7A7254",
                        x"847B5D",
                        x"978C71",
                        x"A0957A",
                        x"A4997E",
                        x"A69B80",
                        x"A69B82",
                        x"9D9179",
                        x"91866D",
                        x"847960",
                        x"83755D",
                        x"8C7E66",
                        x"877964",
                        x"8A7C66",
                        x"85785B",
                        x"837559",
                        x"84795E",
                        x"8F8469",
                        x"998F7D",
                        x"A29886",
                        x"B5957B",
                        x"A38368",
                        x"8D6F56",
                        x"694B32",
                        x"4E351D",
                        x"493018",
                        x"4A311C",
                        x"563D27",
                        x"514A33",
                        x"655E47",
                        x"756A51",
                        x"7C7158",
                        x"9DB8D4",
                        x"E5FFFF",
                        x"FFFDFF",
                        x"FFFEFF",
                        x"FDFFFE",
                        x"FDFFFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FFFEFE",
                        x"FFFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FEFEFE",
                        x"FDFFFA",
                        x"FDFFFA",
                        x"FDFFFC",
                        x"FDFFFC",
                        x"F2E1D1",
                        x"B5A594",
                        x"A09A89",
                        x"999382",
                        x"A29D8C",
                        x"A29D8C",
                        x"9C9481",
                        x"928B78",
                        x"847963",
                        x"80745E",
                        x"796C51",
                        x"75674D",
                        x"7D775B",
                        x"827B5F",
                        x"837C63",
                        x"7A7359",
                        x"847D68",
                        x"88816C",
                        x"837C69",
                        x"7C7562",
                        x"77725C",
                        x"7A7660",
                        x"8C836C",
                        x"968D76",
                        x"A5957D",
                        x"94846C",
                        x"8D7B60",
                        x"8E7D61",
                        x"8B7C60",
                        x"98896C",
                        x"8C7F64",
                        x"84765C",
                        x"8A836C",
                        x"908972",
                        x"98917A",
                        x"98917A",
                        x"909173",
                        x"939376",
                        x"97896F",
                        x"8C7F64",
                        x"7B644C",
                        x"725B42",
                        x"6F5A43",
                        x"634E38",
                        x"696049",
                        x"726952",
                        x"7F7661",
                        x"8D846F",
                        x"877E67",
                        x"797059",
                        x"7A7158",
                        x"776E55",
                        x"675E42",
                        x"645B40",
                        x"6A5D52",
                        x"716459",
                        x"81715C",
                        x"8E7E68",
                        x"927F6D",
                        x"897663",
                        x"7F6B4F",
                        x"645035",
                        x"533E25",
                        x"4E3921",
                        x"3F2C1C",
                        x"362313",
                        x"3A291B",
                        x"49382A",
                        x"4D3F27",
                        x"574931",
                        x"6B5E48",
                        x"7F715C",
                        x"8D7C69",
                        x"8F7E6C",
                        x"837362",
                        x"756554",
                        x"73634E",
                        x"71604B",
                        x"655E49",
                        x"635B46",
                        x"5B5945",
                        x"66634F",
                        x"756E5D",
                        x"766F5E",
                        x"7F7567",
                        x"7D7365",
                        x"7F7766",
                        x"847D6C",
                        x"8B8875",
                        x"A3A08C",
                        x"A8A690",
                        x"999781",
                        x"A68D7A",
                        x"957B68",
                        x"7E6955",
                        x"725D49",
                        x"665641",
                        x"5D4D37",
                        x"51462F",
                        x"4E422C",
                        x"4E402B",
                        x"635540",
                        x"746552",
                        x"746552",
                        x"7F715C",
                        x"7E705A",
                        x"85745F",
                        x"897964",
                        x"776D59",
                        x"7A715C",
                        x"7F7766",
                        x"898171",
                        x"978F81",
                        x"958D7F",
                        x"928A81",
                        x"90887E",
                        x"969586",
                        x"A09F8F",
                        x"A2A492",
                        x"A0A28F",
                        x"AAA18E",
                        x"9F9583",
                        x"9F8776",
                        x"9F8776",
                        x"9E897B",
                        x"9C8679",
                        x"938168",
                        x"907D64",
                        x"83786D",
                        x"7A7065",
                        x"7A735C",
                        x"746D56",
                        x"746854",
                        x"766B57",
                        x"6F644E",
                        x"6D624B",
                        x"746952",
                        x"80745E",
                        x"8A7E6A",
                        x"8D816D",
                        x"7D765F",
                        x"6B644C",
                        x"665F48",
                        x"716A52",
                        x"7C755E",
                        x"817A63",
                        x"847D66",
                        x"817A63",
                        x"918168",
                        x"8A7A61",
                        x"7F7B5E",
                        x"847F63",
                        x"7D785C",
                        x"7E7A5D",
                        x"8E7E64",
                        x"908066",
                        x"897D67",
                        x"837861",
                        x"837969",
                        x"7C7262",
                        x"7F7A69",
                        x"7A7564",
                        x"726F57",
                        x"6D6B52" );
  
  
begin

    clockproc: process
    begin
        PixelClk_tb <= '0'; wait for T/2;
        PixelClk_tb <= '1'; wait for T/2;
    end process; 
    
    horizontalcounter: process(PixelClk_tb)
    begin
        if (rising_edge(PixelClk_tb)) then
            if (countinline = 1650) then
                countinline <= 0;
                
            else
                countinline <= countinline + 1;
            end if;  
        end if;
    end process;
    
    verticalcounter: process(vid_hblank_in_tb)
    begin
        if (rising_edge(vid_hblank_in_tb)) then
            countvertical <= countvertical + 1;
        end if;
    end process;
    
    
    HORIZONTALTIMING: process(PixelClk_tb, vpcount, hpcount)
    begin
        if (countvertical = 720) then
            wavestatetb <= vblank;
        elsif (rising_edge(PixelClk_tb)) then
            case wavestatetb is
                when hblank =>
                    
                    if (countinline = 370) then
                        wavestatetb <= activevideo; 
                        vid_hblank_in_tb <= '0';
                        vid_active_video_in_tb <= '1';    
                    else
                        vid_hblank_in_tb <= '1';
                        wavestatetb <= hblank;
                        vid_active_video_in_tb <= '0';
                        if (countinline >= 110 AND countinline < 150) then
                            vid_hsync_in_tb <= '1';
                        else
                            vid_hsync_in_tb <= '0';
                        end if;
                    end if;
                when activevideo =>
                    if (countinline = 1650) then
                        vid_active_video_in_tb <= '0';
                        wavestatetb <= hblank;
                    else
                        vid_active_video_in_tb <= '1';
                        wavestatetb <= activevideo;
                    end if;
                when others =>
            end case;
        end if;
    end process;



    flipping: process (PixelClk_tb, countvertical, countinline)
    begin
        if (rising_edge(PixelClk_tb)) then
             if ((countvertical mod 10 = 0) AND (countinline = 369)) then
                flip <= not(flip);      
             end if;
        end if;
    end process;
 

    vid_data_in_tb <=  vid_data_inin_tb when vid_active_video_in_tb = '1' else x"000000";
    
    
     testlane1 <= '1' when ((countinline > 145+370)AND(countinline < 187+370)) else '0';
      -- this is a test that will print a purple line and a purple block in a specified range
     
     testlane2 <= '1' when ((countinline > 943+370)AND(countinline < 999+370)) else '0';
     
     
     testdata: process(PixelClk_tb, vid_active_video_in_tb, testlane1, testlane2)
     variable count: natural range 0 to 1279 := 0;
     begin
          if (rising_edge(PixelClk_tb)) then
            if (countvertical = 700-1) then
                if (countinline >= 371 AND countinline <= 1650) then
                    vid_data_inin_tb <= IMGSLICE(countinline-371);
                --count := count + 1;
                end if;
            end if;
--          elsif (vid_active_video_in_tb = '1' AND (testlane1 = '1' OR testlane2 = '1')) then
--              vid_data_inin_tb <= x"EEEEEE";
--          else
--              vid_data_inin_tb <= x"333333";
          end if;
     end process;    
    
--   testdata: process (PixelClk_tb)
--   begin
--        if (rising_edge(PixelClk_tb)) then
--                if (flip = '0') then
--                    vid_data_inin_tb <= x"333333";
--                else
--                    vid_data_inin_tb <= x"EEEEEE";
--                end if;
--        end if;
--   end process;

    OUTPUT_PROC: process
        file OUTFILE: text open WRITE_MODE is "outimg.txt";
        variable BUF: line;    
    begin
          --write(BUF, string'("P6 1280 720 255"));
          --writeline(OUTFILE, BUF);
          while ((countvertical < 720)) loop
            if (vid_active_video_out_tb = '1') then
                write(BUF, x"00"&vid_data_out_tb);
                writeline(OUTFILE, BUF);
            end if;
            wait for t;
          end loop;
          
       wait;
       end process;  
           
--    clockproc: process
--    begin
--        PixelClk <= '0'; wait for T/2;
--        PixelClk <= '1'; wait for T/2;
--    end process; 

--    timing: process(PixelClk, vpcount, hpcount)
--    begin
--        --done <= '0';
--        --vid_vblank_in <= '0';
--        --vid_active_video_in <= '0';
--        if (hpcount > 110 AND hpcount <150) then
--            vid_hsync_in <= '1';
--        else
--            vid_hsync_in <= '0';
--        end if;
        
--        if (rising_edge(PixelClk)) then
--            if (vpcount = nlines) then
--                --wait
--                vid_active_video_in <= '0';
--                vid_vblank_in <= '1';
--                wavestate <= vblank;
--            elsif (hpcount >= hblanksize-1) then
--                vid_vblank_in <= '0';
--                vid_active_video_in <= '1';
--                wavestate <= activevideo;
--                if (hpcount = (vidonsize+hblanksize)-1) then
--                    wavestate <= hblank;
--                    hpcount <= 0;
--                    vpcount <= vpcount + 1;
--                else
--                    wavestate <= activevideo;
--                    hpcount <= hpcount+1;
--                end if;
--            else
--                wavestate <= hblank;
--                vid_vblank_in <= '0';
--                vid_active_video_in <= '0';
--                hpcount <= hpcount+1;
--            end if;
--        end if;
--    end process;
    
--  flipping: process (PixelClk, vpcount, vid_active_video_in)
--  begin
--      if (rising_edge(PixelClk)) then
--              if ((vpcount mod 10 = 0) AND (hpcount = 0))then
--                  flip <= not(flip);      
--              end if;
--      end if;
--  end process;
  
-- vid_data_in <=  vid_data_inin when vid_active_video_in = '1' else x"000000";
  
--  testdata: process (PixelClk, vpcount)
--  begin
--      if (rising_edge(PixelClk)) then
--              if (flip = '0') then
--                  vid_data_inin <= x"333333";
--              else
--                  vid_data_inin <= x"EEEEEE";
--              end if;
--      end if;
--  end process;

  UUT: color port map (
    PixelClk => PixelClk_tb,
    sel => sel_tb,
    vid_data_in => vid_data_in_tb,
    vid_active_video_in => vid_active_video_in_tb,
    vid_field_id_in => vid_field_id_in_tb,
    vid_hblank_in => vid_hblank_in_tb,
    vid_hsync_in => vid_hsync_in_tb,
    vid_vblank_in => vid_vblank_in_tb,
    vid_vsync_in => vid_vsync_in_tb, 
    vid_data_out => vid_data_out_tb, 
    vid_active_video_out => vid_active_video_out_tb, 
    vid_field_id_out => vid_field_id_out_tb,
    vid_hblank_out => vid_hblank_out_tb,
    vid_hsync_out =>     vid_hsync_out_tb,
    vid_vblank_out => vid_vblank_out_tb,
    vid_vsync_out => vid_vsync_out_tb
  );
  
  stim_proc: process
  begin
        sel_tb <= "0100";
        --flip <= '1';
        wait for t;
        wait;
  end process;     

end;